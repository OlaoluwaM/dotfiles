name: booklore-library

services:
  booklore:
    # Official Docker Hub image:
    image: booklore/booklore:latest
    # Or the GHCR image:
    # image: ghcr.io/booklore-app/booklore:latest
    container_name: booklore
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      - DATABASE_URL=jdbc:mariadb://mariadb:3306/booklore   # Only modify this if you're familiar with JDBC and your database setup
      - DATABASE_USERNAME=booklore                          # Must match MYSQL_USER defined in the mariadb container
      - DATABASE_PASSWORD=your_secure_password              # Use a strong password; must match MYSQL_PASSWORD defined in the mariadb container
      - SWAGGER_ENABLED=false                               # Enable or disable Swagger UI (API docs). Set to 'true' to allow access; 'false' to block access (recommended for production).
    depends_on:
      mariadb:
        condition: service_healthy
    ports:
      - "6060:6060"
    volumes:
      # Note that the below is shorthand for bind-mount syntax (https://docs.docker.com/reference/compose-file/services/#short-syntax-5)
      - $HOME/Documents/booklore/app-data:/app/data       # Internal app data (settings, metadata, cache)
      - $HOME/Documents/booklore/technical-library:/technical-library       # Book library folder — point to one of your collections
      - $HOME/Documents/booklore/technical-library/ebooks:/technical-library/ebooks       # Book library folder — point to one of your collections
      - $HOME/Documents/booklore/technical-library/papers:/technical-library/papers       # Book library folder — point to one of your collections
      - $HOME/Documents/booklore/non-technical-library:/non-technical-library       # Another book library — you can mount multiple library folders this way
      - $HOME/Documents/booklore/non-technical-library/ebooks:/non-technical-library/ebooks       # Another book library — you can mount multiple library folders this way
      - $HOME/Documents/booklore/bookdrop:/bookdrop   # Bookdrop folder — drop new files here for automatic import into libraries
    restart: unless-stopped

# Note that the following service creates an anonymous volume. Check our docker cheat sheet on how to verify this
# I am not entirely sure how we can go about naming the created volume in this case
  mariadb:
    image: lscr.io/linuxserver/mariadb:11.4.5
    container_name: mariadb
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      - MYSQL_ROOT_PASSWORD=super_secure_password  # Use a strong password for the database's root user, should be different from MYSQL_PASSWORD
      - MYSQL_DATABASE=booklore
      - MYSQL_USER=booklore                        # Must match DATABASE_USERNAME defined in the booklore container
      - MYSQL_PASSWORD=your_secure_password        # Use a strong password; must match DATABASE_PASSWORD defined in the booklore container
    # volumes:
      # - /your/local/path/to/mariadb/config:/config
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "mariadb-admin", "ping", "-h", "localhost"]
      interval: 5s
      timeout: 5s
      retries: 10
